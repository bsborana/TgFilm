<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TG Film — Modular OTT-style</title>
  <style>
    :root {
      --bg: #0b0f14;
      --bg-elev: #12161d;
      --text: #e8ecf2;
      --muted: #9aa4af;
      --accent: #4cc9f0;
      --accent-2: #7b2cff;
      --card: #141a22;
      --border: #1f2732;
      --success: #35d073;
      --danger: #ff5c8a;
      --warning: #f5c84c;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius-lg: 18px;
      --radius-md: 14px;
      --radius-sm: 10px;
      --transition-fast: 180ms ease;
      --transition-medium: 280ms ease;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.5;
    }

    /* Sticky header */
    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: saturate(1.2) blur(8px);
      background: linear-gradient(180deg, rgba(18, 22, 29, 0.8), rgba(18, 22, 29, 0.6));
      border-bottom: 1px solid var(--border);
    }
    .header-inner {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 16px;
      align-items: center;
      padding: 12px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo {
      width: 40px; height: 40px;
      border-radius: 10px;
      background: radial-gradient(circle at 30% 20%, var(--accent), var(--accent-2));
      box-shadow: var(--shadow);
    }
    .brand-text { display: grid; }
    .brand-name { font-weight: 700; letter-spacing: 0.4px; }
    .brand-tagline { font-size: 12px; color: var(--muted); }

    nav {
      display: flex; gap: 18px; justify-content: center;
    }
    nav a {
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 10px;
      transition: background var(--transition-fast), color var(--transition-fast);
    }
    nav a:hover { background: rgba(124, 94, 255, 0.18); color: #fff; }

    .search-wrap {
      display: flex; align-items: center; gap: 8px;
      background: var(--bg-elev);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px 10px;
      width: 100%;
      max-width: 360px;
    }
    .search-wrap input {
      flex: 1;
      background: transparent; border: 0; outline: none;
      color: var(--text);
      font-size: 14px;
    }
    .search-wrap .hint {
      color: var(--muted); font-size: 12px;
    }

    /* Hero carousel */
    .hero {
      position: relative;
      max-width: 1200px;
      margin: 18px auto 10px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .slides {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 100%;
      transition: transform var(--transition-medium);
    }
    .slide {
      position: relative;
      min-height: 320px;
      background-size: cover;
      background-position: center;
    }
    .slide::after {
      content: "";
      position: absolute; inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.2), rgba(11,15,20,0.75));
    }
    .slide-content {
      position: absolute; inset: 0;
      display: flex; flex-direction: column; justify-content: flex-end;
      padding: 24px;
      gap: 8px;
    }
    .slide-title { font-size: 28px; font-weight: 800; text-shadow: 0 4px 24px rgba(0,0,0,0.5); }
    .slide-tag { color: var(--muted); max-width: 640px; }
    .slide-actions { display: flex; gap: 12px; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      border: 0; outline: none; cursor: pointer;
      border-radius: 12px; padding: 10px 14px;
      font-weight: 700; transition: transform var(--transition-fast), background var(--transition-fast), opacity var(--transition-fast);
    }
    .btn-primary { background: linear-gradient(90deg, var(--accent-2), var(--accent)); color: #fff; }
    .btn-primary:hover { transform: translateY(-1px); opacity: 0.95; }
    .btn-ghost { background: rgba(255,255,255,0.08); color: var(--text); }
    .btn-ghost:hover { background: rgba(255,255,255,0.12); }

    /* Sections */
    .section {
      max-width: 1200px;
      margin: 18px auto;
      padding: 0 20px;
    }
    .section-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px;
    }
    .section-title { font-size: 20px; font-weight: 800; }
    .grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    /* Movie card */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      overflow: hidden;
      position: relative;
      transition: transform var(--transition-medium), box-shadow var(--transition-medium), border-color var(--transition-medium);
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.45);
      border-color: rgba(124, 94, 255, 0.3);
    }
    .poster {
      aspect-ratio: 2/3;
      width: 100%;
      background: linear-gradient(135deg, #1c2430, #0f1319);
      display: grid; place-items: center; color: var(--muted);
      font-weight: 800; letter-spacing: 1px;
      background-size: cover; background-position: center;
    }
    .card-body { padding: 10px; display: grid; gap: 6px; }
    .card-title { font-weight: 700; font-size: 14px; }
    .meta { color: var(--muted); font-size: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
    .rating { color: #ffd166; font-weight: 700; }
    .badge-new {
      position: absolute; top: 8px; left: 8px;
      background: linear-gradient(90deg, #ff7d7d, #ff5c8a);
      color: #fff; font-size: 11px; font-weight: 800;
      padding: 6px 8px; border-radius: 10px;
      box-shadow: var(--shadow);
    }

    .hover-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,0.65));
      opacity: 0; transition: opacity var(--transition-medium);
      display: flex; align-items: flex-end; justify-content: center;
      padding: 12px;
    }
    .card:hover .hover-overlay { opacity: 1; }
    .overlay-content {
      display: flex; gap: 8px;
    }

    /* IMDb/TMDb fetch tool */
    .tool {
      background: var(--bg-elev);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      display: grid; gap: 12px;
    }
    .tool-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
    }
    .tool input {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      padding: 10px;
      font-size: 14px;
      outline: none;
    }
    .tool .results {
      display: grid; gap: 10px;
    }
    .skeleton {
      display: grid; grid-template-columns: 120px 1fr; gap: 12px;
      align-items: center;
    }
    .sk-poster, .sk-line {
      background: linear-gradient(90deg, #19202a 0%, #222a35 50%, #19202a 100%);
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite;
      border-radius: 10px;
    }
    .sk-poster { width: 120px; height: 180px; }
    .sk-line { height: 14px; }
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Request section */
    .request {
      display: grid; gap: 12px;
      background: var(--bg-elev);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
    }
    .req-steps {
      display: grid; gap: 6px;
    }
    .req-steps li { margin-left: 18px; color: var(--muted); }
    .req-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .format-box {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      color: var(--text);
      font-size: 14px;
      width: 100%;
      min-height: 110px;
      resize: vertical;
    }
    .toast {
      position: fixed; bottom: 18px; right: 18px;
      background: #0e1912; color: #b5ffd9;
      border: 1px solid #1e3b2a;
      padding: 10px 12px; border-radius: 10px;
      box-shadow: var(--shadow);
      opacity: 0; transform: translateY(8px);
      transition: opacity var(--transition-medium), transform var(--transition-medium);
      pointer-events: none;
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    /* Footer */
    footer {
      border-top: 1px solid var(--border);
      margin-top: 24px;
      padding: 18px 20px;
      text-align: center;
      color: var(--muted);
    }

    /* Responsive rules */
    @media (max-width: 820px) {
      .header-inner { grid-template-columns: auto 1fr; grid-template-rows: auto auto; }
      nav { justify-content: flex-start; grid-column: span 2; order: 3; }
      .search-wrap { max-width: none; }
      .slide-title { font-size: 24px; }
      .grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
    }
    @media (max-width: 640px) {
      .slide { min-height: 260px; }
      .grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 480px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
      .slide-title { font-size: 22px; }
      .brand-tagline { display: none; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand-text">
          <div class="brand-name">TG Film</div>
          <div class="brand-tagline">Stream bold stories. Discover new worlds.</div>
        </div>
      </div>

      <nav aria-label="Primary">
        <a href="#new" title="New releases">New</a>
        <a href="#recommended" title="Recommended picks">Recommended</a>
        <a href="#request" title="Request a movie">Request</a>
      </nav>

      <div class="search-wrap" role="search">
        <input id="search" type="text" placeholder="Search title, year, language, genre…" aria-label="Search movies" />
        <span class="hint">Enter keywords</span>
      </div>
    </div>
  </header>

  <!-- Hero carousel -->
  <section class="hero" aria-label="Featured">
    <div class="slides" id="slides">
      <div class="slide" style="background-image:url('https://via.placeholder.com/1200x500/1a2230/FFFFFF?text=KGF');">
        <div class="slide-content">
          <div class="slide-title">KGF</div>
          <div class="slide-tag">Power, ambition, and destiny collide in a world ruled by gold.</div>
          <div class="slide-actions">
            <button class="btn btn-primary">Watch Now</button>
            <button class="btn btn-ghost">Add to List</button>
          </div>
        </div>
      </div>
      <div class="slide" style="background-image:url('https://via.placeholder.com/1200x500/1a2230/FFFFFF?text=Pushpa');">
        <div class="slide-content">
          <div class="slide-title">Pushpa</div>
          <div class="slide-tag">A defiant rise from the shadows to the top of the red sanders empire.</div>
          <div class="slide-actions">
            <button class="btn btn-primary">Watch Now</button>
            <button class="btn btn-ghost">Add to List</button>
          </div>
        </div>
      </div>
      <div class="slide" style="background-image:url('https://via.placeholder.com/1200x500/1a2230/FFFFFF?text=Avengers');">
        <div class="slide-content">
          <div class="slide-title">Avengers</div>
          <div class="slide-tag">Earth’s mightiest heroes assemble to face threats beyond imagination.</div>
          <div class="slide-actions">
            <button class="btn btn-primary">Watch Now</button>
            <button class="btn btn-ghost">Add to List</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- New Movies -->
  <section class="section" id="new">
    <div class="section-header">
      <div class="section-title">New movies</div>
    </div>
    <div class="grid" id="grid-new">
      <!-- Cards injected by JS -->
    </div>
  </section>

  <!-- Recommended Movies -->
  <section class="section" id="recommended">
    <div class="section-header">
      <div class="section-title">Recommended for you</div>
    </div>
    <div class="grid" id="grid-rec">
      <!-- Cards injected by JS -->
    </div>
  </section>

  <!-- IMDb Poster Fetch Tool -->
  <section class="section" id="fetch-tool">
    <div class="section-header">
      <div class="section-title">IMDb poster fetch</div>
    </div>
    <div class="tool">
      <div class="tool-row">
        <input id="imdbId" type="text" placeholder="Enter IMDb ID (e.g., tt3896198)" aria-label="IMDb ID" />
        <button id="fetchBtn" class="btn btn-primary">Fetch Poster</button>
      </div>
      <div class="results" id="results">
        <!-- Loading skeleton or content appears here -->
      </div>
    </div>
  </section>

  <!-- Request Section -->
  <section class="section" id="request">
    <div class="section-header">
      <div class="section-title">Request a movie</div>
    </div>
    <div class="request">
      <ul class="req-steps">
        <li>Check if the movie already exists using the search above.</li>
        <li>Join our Telegram group to submit requests.</li>
        <li>Copy the format below, fill in details, and send on Telegram.</li>
      </ul>
      <div class="req-actions">
        <a href="https://t.me/your_group_link" target="_blank" rel="noopener" class="btn btn-primary">Join on Telegram</a>
        <button id="copyBtn" class="btn btn-ghost">Copy format</button>
      </div>
      <textarea id="formatBox" class="format-box" aria-label="Request format">Movie Name:
Language:
Year:</textarea>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    © 2025 TG Movies — All Rights Reserved.
  </footer>

  <div id="toast" class="toast">✅ Request format copied!</div>

  <script>
    // ===== Config =====
    const TMDB_API_KEY = "83cc5358fefe8b5ffb79b0ba491fd1a3"; // Required for IMDb poster fetch
    const SHEET_API_URL = "https://sheetdb.io/api/v1/8gisuluuwy7j1"; // TODO: replace with your SheetDB/Sheet.best URL

    // ===== Helpers =====
    function normalizeMovie(m) {
      // Support both Sheet headers (Title etc.) or lower-case keys
      return {
        title: m.Title || m.title || "Untitled",
        year: m.Year || m.year || "",
        language: m.Language || m.language || "",
        genre: m.Genre || m.genre || "",
        rating: m.Rating || m.rating || "",
        poster: m.Poster || m.poster || "",
        watch: m.Watch || m.watch || "#"
      };
    }

    function createCard(movie, isNew=false) {
      const card = document.createElement("article");
      card.className = "card";
      card.setAttribute("data-title", String(movie.title).toLowerCase());
      card.setAttribute("data-year", String(movie.year));
      card.setAttribute("data-language", String(movie.language).toLowerCase());
      card.setAttribute("data-genre", String(movie.genre).toLowerCase());

      const posterBg = movie.poster ? `background-image:url('${movie.poster}');` : "";
      card.innerHTML = `
        ${isNew ? '<div class="badge-new">NEW</div>' : ""}
        <a href="${movie.watch}" target="_blank" rel="noopener" style="text-decoration:none; color:inherit;">
          <div class="poster" style="${posterBg}"></div>
        </a>
        <div class="card-body">
          <div class="card-title">${movie.title}</div>
          <div class="meta">
            <span>${movie.year}</span>
            <span>• ${movie.language}</span>
            <span>• ${movie.genre}</span>
            <span class="rating">⭐ ${movie.rating}</span>
          </div>
        </div>
        <div class="hover-overlay">
          <div class="overlay-content">
            <a class="btn btn-primary" href="${movie.watch}" target="_blank" rel="noopener">Watch</a>
            <button class="btn btn-ghost" type="button">Details</button>
          </div>
        </div>
      `;
      return card;
    }

    // ===== Dynamic data from Google Sheet =====
    const gridNew = document.getElementById("grid-new");
    const gridRec = document.getElementById("grid-rec");

    async function loadMoviesFromSheet() {
      try {
        const res = await fetch(SHEET_API_URL);
        if (!res.ok) throw new Error("Failed to fetch sheet data");
        const raw = await res.json();

        // Some services return {data: [...]}; normalize if needed
        const list = Array.isArray(raw) ? raw : (Array.isArray(raw.data) ? raw.data : []);
        const movies = list.map(normalizeMovie);

        // Split: last 5 as "New", rest as "Recommended"
        const total = movies.length;
        const lastFiveStart = Math.max(total - 5, 0);
        const newList = movies.slice(lastFiveStart);
        const recList = movies.slice(0, lastFiveStart);

        // Render
        gridNew.innerHTML = "";
        gridRec.innerHTML = "";

        newList.forEach(m => gridNew.appendChild(createCard(m, true)));
        recList.forEach(m => gridRec.appendChild(createCard(m, false)));
      } catch (err) {
        // Fallback message
        gridNew.innerHTML = `<div style="color:#ff9aa2">Error loading movies: ${err.message}</div>`;
      }
    }

    loadMoviesFromSheet();

    // ===== Search filter (title/year/language/genre) =====
    const search = document.getElementById("search");
    function filterCards() {
      const q = search.value.trim().toLowerCase();
      const allCards = [...gridNew.children, ...gridRec.children];
      allCards.forEach(card => {
        if (!q) { card.style.display = ""; return; }
        const match =
          card.getAttribute("data-title").includes(q) ||
          card.getAttribute("data-year").includes(q) ||
          card.getAttribute("data-language").includes(q) ||
          card.getAttribute("data-genre").includes(q);
        card.style.display = match ? "" : "none";
      });
    }
    search.addEventListener("input", filterCards);

    // ===== Hero auto-rotate every 5s =====
    const slidesEl = document.getElementById("slides");
    let currentSlide = 0;
    function rotateHero() {
      const total = slidesEl.children.length;
      currentSlide = (currentSlide + 1) % total;
      slidesEl.style.transform = `translateX(-${currentSlide * 100}%)`;
    }
    setInterval(rotateHero, 5000);

    // ===== IMDb Poster Fetch using TMDb /find =====
    const imdbInput = document.getElementById("imdbId");
    const fetchBtn = document.getElementById("fetchBtn");
    const results = document.getElementById("results");

    function showSkeleton() {
      results.innerHTML = `
        <div class="skeleton">
          <div class="sk-poster"></div>
          <div>
            <div class="sk-line" style="width: 60%;"></div><br/>
            <div class="sk-line" style="width: 40%;"></div>
          </div>
        </div>
      `;
    }
    async function fetchPoster() {
      const imdbId = imdbInput.value.trim();
      if (!imdbId) {
        results.innerHTML = `<span style="color:${getComputedStyle(document.body).getPropertyValue('--muted')}">Enter a valid IMDb ID (e.g., tt3896198)</span>`;
        return;
      }
      showSkeleton();

      try {
        if (!TMDB_API_KEY || TMDB_API_KEY.includes("PASTE_")) {
          throw new Error("Missing TMDb API key");
        }
        const url = `https://api.themoviedb.org/3/find/${encodeURIComponent(imdbId)}?api_key=${TMDB_API_KEY}&external_source=imdb_id`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("TMDb request failed");
        const data = await res.json();

        const item =
          (data.movie_results && data.movie_results[0]) ||
          (data.tv_results && data.tv_results[0]) ||
          (data.person_results && data.person_results[0]);

        if (!item) {
          results.innerHTML = `<span style="color:#ff9aa2">No results found for ${imdbId}.</span>`;
          return;
        }

        const posterUrl = item.poster_path
          ? `https://image.tmdb.org/t/p/w342${item.poster_path}`
          : "https://via.placeholder.com/240x360/233040/FFFFFF?text=No+Poster";

        const title = item.title || item.name || "Unknown title";
        const tmdbId = item.id;
        const isTv = !!item.name && !item.title;

        results.innerHTML = `
          <div style="display:grid; grid-template-columns: 140px 1fr; gap: 12px; align-items:center;">
            <img src="${posterUrl}" alt="${title}" style="width:140px; height:auto; border-radius:12px; border:1px solid var(--border);" />
            <div>
              <div style="font-weight:800; font-size:16px; margin-bottom:6px;">${title}</div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <a class="btn btn-ghost" href="https://www.imdb.com/title/${imdbId}/" target="_blank" rel="noopener">Open IMDb</a>
                <a class="btn btn-ghost" href="https://www.themoviedb.org/${isTv ? "tv" : "movie"}/${tmdbId}" target="_blank" rel="noopener">Open TMDb</a>
              </div>
            </div>
          </div>
        `;
      } catch (err) {
        results.innerHTML = `<span style="color:#ff9aa2">Error: ${err.message}. Check your API key or try again.</span>`;
      }
    }
    fetchBtn.addEventListener("click", fetchPoster);
    imdbInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") fetchPoster();
    });

    // ===== Copy request format with toast (guarded) =====
    const copyBtn = document.getElementById("copyBtn");
    const formatBox = document.getElementById("formatBox");
    const toast = document.getElementById("toast");

    if (copyBtn && formatBox && toast) {
      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(formatBox.value);
          toast.classList.add("show");
          setTimeout(() => toast.classList.remove("show"), 1800);
        } catch {
          formatBox.select();
          document.execCommand("copy");
          toast.classList.add("show");
          setTimeout(() => toast.classList.remove("show"), 1800);
        }
      });
    }

    // ===== Smooth focus visuals =====
    document.querySelectorAll("button, a, input, textarea").forEach(el => {
      el.addEventListener("focus", () => el.style.boxShadow = "0 0 0 2px rgba(124,94,255,0.45)");
      el.addEventListener("blur", () => el.style.boxShadow = "none");
    });
  </script>
</body>
</html>
