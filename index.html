<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TG Film ‚Äî Modular OTT</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f14;
      --bg-elev:#111722;
      --text:#e6edf6;
      --muted:#9bb0ca;
      --accent:#29b6f6; /* neon blue */
      --accent-glow:0 0 12px rgba(41,182,246,.6), 0 0 24px rgba(41,182,246,.35);
      --danger:#ff5252;
      --success:#2ecc71;
      --card:#151c28;
      --border:#1f2736;
      --radius:14px;
      --shadow:0 12px 40px rgba(0,0,0,.45);
      --transition:250ms cubic-bezier(.22,.61,.36,1);
    }
    *{box-sizing:border-box}
    html,body{background:var(--bg);color:var(--text);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;margin:0}
    a{color:var(--accent);text-decoration:none}
    img{display:block;width:100%;height:auto;border-radius:12px}

    /* Header */
    header{
      position:sticky;top:0;z-index:1000;background:rgba(11,15,20,.85);
      backdrop-filter:blur(12px);border-bottom:1px solid var(--border);
      transition:height var(--transition), padding var(--transition), background var(--transition);
    }
    .header-inner{
      max-width:1200px;margin:0 auto;padding:18px 16px;display:flex;gap:16px;align-items:center;justify-content:space-between;
    }
    header.shrink .header-inner{padding:10px 16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,#0af,#06f);
      box-shadow:var(--accent-glow);
    }
    .brand h1{font-size:1.05rem;margin:0;letter-spacing:.4px}
    nav{display:flex;gap:18px;align-items:center}
    .nav-link{position:relative;padding:6px 4px;color:var(--text);opacity:.9;transition:opacity var(--transition)}
    .nav-link:hover{opacity:1}
    .nav-link.active::after{
      content:"";position:absolute;left:0;bottom:-6px;width:100%;height:2px;background:var(--accent);
      border-radius:2px;box-shadow:var(--accent-glow);animation:underline .9s ease both;
    }
    @keyframes underline{from{transform:scaleX(.2);opacity:0}to{transform:scaleX(1);opacity:1}}

    /* Search */
    .search-wrap{
      flex:1;max-width:480px;position:relative;
    }
    .search-input{
      width:100%;padding:10px 40px 10px 12px;border-radius:12px;border:1px solid var(--border);
      background:var(--bg-elev);color:var(--text);outline:none;transition:border var(--transition), box-shadow var(--transition);
    }
    .search-input:focus{border-color:var(--accent);box-shadow:var(--accent-glow)}
    .search-icon{
      position:absolute;right:10px;top:50%;transform:translateY(-50%);opacity:.7
    }

    /* Sections container */
    main{max-width:1200px;margin:16px auto;padding:0 16px}

    /* Hero Carousel */
    .hero{position:relative;border-radius:18px;overflow:hidden;background:#0c121a}
    .hero-slide{position:absolute;inset:0;opacity:0;pointer-events:none;transition:opacity 600ms ease, transform 700ms ease}
    .hero-slide.active{opacity:1;pointer-events:auto;transform:translate3d(0,0,0)}
    .hero-slide.enter{transform:translate3d(10px,0,0)}
    .hero-image{width:100%;height:52vh;object-fit:cover;filter:saturate(1.05) contrast(1.05)}
    .hero-overlay{
      position:absolute;inset:0;background:linear-gradient(to top, rgba(11,15,20,.85), rgba(11,15,20,.25) 40%, rgba(0,0,0,0) 70%);
    }
    .hero-content{
      position:absolute;left:24px;bottom:24px;max-width:60%;display:flex;flex-direction:column;gap:8px
    }
    .hero-title{font-size:1.6rem;font-weight:600;margin:0;text-shadow:0 2px 20px rgba(0,0,0,.35)}
    .hero-tag{color:var(--muted);font-size:.95rem}
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:12px;border:1px solid var(--border);
      background:linear-gradient(180deg, #132234, #0f1928);color:var(--text);cursor:pointer;transition:transform var(--transition), box-shadow var(--transition), border var(--transition)
    }
    .btn:hover{transform:translateY(-1px);box-shadow:var(--accent-glow);border-color:var(--accent)}
    .hero-nav{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;padding:0 12px}
    .nav-btn{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;background:rgba(19,30,45,.6);border:1px solid var(--border);cursor:pointer;transition:all var(--transition)}
    .nav-btn:hover{box-shadow:var(--accent-glow);border-color:var(--accent)}
    .hero-dots{position:absolute;left:50%;bottom:14px;transform:translateX(-50%);display:flex;gap:8px}
    .dot{width:8px;height:8px;border-radius:50%;background:#2a384f;transition:all var(--transition)}
    .dot.active{background:var(--accent);box-shadow:var(--accent-glow)}

    /* Grid */
    .section{margin-top:28px}
    .section-title{font-size:1.2rem;margin:0 0 12px}
    .grid{
      display:grid;grid-template-columns:repeat(6,1fr);gap:14px
    }
    @media (max-width:1280px){.grid{grid-template-columns:repeat(5,1fr)}}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:820px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:480px){.grid{grid-template-columns:repeat(2,1fr)}}

    /* Card */
    .card{
      position:relative;border-radius:16px;overflow:hidden;background:var(--card);border:1px solid var(--border);
      box-shadow:var(--shadow);transform:translateZ(0);transition:transform var(--transition), box-shadow var(--transition), border var(--transition)
    }
    .card:hover{transform:translateY(-4px) scale(1.02);box-shadow:var(--accent-glow);border-color:var(--accent)}
    .card-media{aspect-ratio:2/3;overflow:hidden}
    .card-media img{width:100%;height:100%;object-fit:cover;transition:transform 500ms ease;will-change:transform}
    .card:hover .card-media img{transform:scale(1.06)}
    .card-overlay{
      position:absolute;inset:auto 8px 8px 8px;padding:8px;border-radius:12px;background:linear-gradient(180deg, rgba(19,30,45,.75), rgba(19,30,45,.4));
      opacity:0;transform:translateY(6px);transition:opacity var(--transition), transform var(--transition)
    }
    .card:hover .card-overlay{opacity:1;transform:translateY(0)}
    .card-title{font-size:.95rem;margin:0 0 4px}
    .card-meta{color:var(--muted);font-size:.8rem}
    .card-actions{display:flex;gap:8px;margin-top:8px}
    .badge-new{
      position:absolute;top:8px;left:8px;background:linear-gradient(135deg,#ff7f50,#ff3d3d);
      color:white;font-size:.7rem;padding:6px 8px;border-radius:999px;box-shadow:0 0 8px rgba(255,61,61,.6);
      animation:pulse 1.4s ease-in-out infinite
    }
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}

    /* Movie Player (collapsible under header) */
    #movie-player{
      position:relative;margin:0 auto 22px;max-width:1200px;border:1px solid var(--border);border-radius:18px;overflow:hidden;background:var(--bg-elev);
      transform-origin:top center;opacity:0;max-height:0;transition:max-height 500ms ease, opacity 450ms ease, transform 500ms ease;
    }
    #movie-player.active{opacity:1;max-height:1000px;transform:scale(1)}
    .player-inner{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:16px}
    @media (max-width:820px){.player-inner{grid-template-columns:1fr}}
    .player-frame{
      position:relative;width:100%;aspect-ratio:16/9;border-radius:12px;overflow:hidden;background:#000;border:1px solid var(--border)
    }
    .player-meta{padding:8px 4px}
    .player-title{font-size:1.1rem;margin:0 0 6px}
    .player-tags{display:flex;flex-wrap:wrap;gap:8px;color:var(--muted);font-size:.9rem}
    .player-close{
      position:absolute;right:10px;top:10px;width:36px;height:36px;border-radius:10px;border:1px solid var(--border);
      background:rgba(19,30,45,.6);color:var(--text);display:grid;place-items:center;cursor:pointer;transition:all var(--transition)
    }
    .player-close:hover{box-shadow:var(--accent-glow);border-color:var(--accent)}

    /* IMDb Poster Fetch Tool */
    .tool{
      margin-top:28px;padding:16px;border:1px solid var(--border);border-radius:16px;background:var(--bg-elev)
    }
    .tool-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .tool input{
      flex:1;min-width:220px;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0f1622;color:var(--text)
    }
    .skeleton{
      width:160px;height:240px;border-radius:12px;background:linear-gradient(90deg,#121a28 25%, #162233 37%, #121a28 63%);
      background-size:400% 100%;animation:shimmer 1.1s ease-in-out infinite;
    }
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .result{display:flex;gap:12px;margin-top:12px;align-items:flex-start}
    .result img{width:160px;height:240px;object-fit:cover;border:1px solid var(--border)}
    .result-info{flex:1}

    /* Toast */
    .toast{
      position:fixed;left:50%;bottom:24px;transform:translateX(-50%) translateY(40px);background:#122033;border:1px solid var(--border);
      color:var(--text);padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transition:opacity var(--transition), transform var(--transition)
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    /* Footer */
    footer{padding:24px;color:var(--muted);text-align:center}

    /* Utility */
    .hidden{display:none}
    mark{background:transparent;color:var(--accent);font-weight:600}
  </style>
</head>
<body>
  <header id="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo"></div>
        <h1>TG Film</h1>
      </div>
      <nav>
        <a href="#hero" class="nav-link active">Home</a>
        <a href="#new" class="nav-link">New</a>
        <a href="#recommended" class="nav-link">Recommended</a>
        <a href="#tools" class="nav-link">Tools</a>
        <a href="#request" class="nav-link">Request</a>
      </nav>
      <div class="search-wrap">
        <input id="search" class="search-input" type="text" placeholder="Search movies..." aria-label="Search" />
        <span class="search-icon">üîé</span>
      </div>
    </div>
  </header>

  <!-- Collapsible player lives just under header -->
  <section id="movie-player">
    <button class="player-close" id="player-close" title="Close">√ó</button>
    <div class="player-inner">
      <div class="player-frame" id="player-frame"></div>
      <div class="player-meta">
        <h3 class="player-title" id="player-title"></h3>
        <div class="player-tags" id="player-tags"></div>
        <div class="player-actions" style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" id="open-imdb">IMDb</button>
          <button class="btn" id="open-tmdb">TMDb</button>
        </div>
      </div>
    </div>
  </section>

  <main>
    <!-- Hero Carousel -->
    <section id="hero" class="hero">
      <div class="hero-slide active">
        <img class="hero-image" src="https://images.unsplash.com/photo-1524985069026-dd778a71c7b0?q=80&w=1600&auto=format&fit=crop" alt="Cinema" loading="lazy">
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <h2 class="hero-title">Experience cinema at home</h2>
          <p class="hero-tag">Curated picks, smooth playback, and premium UI polish.</p>
          <button class="btn" data-hero-play="0">Watch Now ‚ñ∂</button>
        </div>
      </div>
      <div class="hero-slide">
        <img class="hero-image" src="https://images.unsplash.com/photo-1502139214985-d4e9810e31e9?q=80&w=1600&auto=format&fit=crop" alt="Projector" loading="lazy">
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <h2 class="hero-title">Fresh releases, updated weekly</h2>
          <p class="hero-tag">Discover new titles with instant search and highlights.</p>
          <button class="btn" data-hero-play="1">Watch Now ‚ñ∂</button>
        </div>
      </div>
      <div class="hero-slide">
        <img class="hero-image" src="https://images.unsplash.com/photo-1497032205916-ac2b17987b10?q=80&w=1600&auto=format&fit=crop" alt="Popcorn" loading="lazy">
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <h2 class="hero-title">Recommended gems, handpicked</h2>
          <p class="hero-tag">Classic favorites and critics‚Äô choice.</p>
          <button class="btn" data-hero-play="2">Watch Now ‚ñ∂</button>
        </div>
      </div>
      <div class="hero-nav">
        <button class="nav-btn" id="prev">‚ü®</button>
        <button class="nav-btn" id="next">‚ü©</button>
      </div>
      <div class="hero-dots" id="hero-dots"></div>
    </section>

    <!-- New Movies -->
    <section id="new" class="section">
      <h3 class="section-title">New movies</h3>
      <div class="grid" id="grid-new"></div>
    </section>

    <!-- Recommended Movies -->
    <section id="recommended" class="section">
      <h3 class="section-title">Recommended</h3>
      <div class="grid" id="grid-recommended"></div>
    </section>

    <!-- IMDb Poster Fetch Tool -->
    <section id="tools" class="tool">
      <h3 class="section-title">IMDb ‚Üí TMDb poster fetch</h3>
      <div class="tool-row">
        <input id="imdb-id" placeholder="Enter IMDb ID (e.g., tt1375666)" />
        <input id="tmdb-key" placeholder="TMDb API Key (client-side)" />
        <button class="btn" id="fetch-poster">Fetch Poster</button>
      </div>
      <div class="result" id="fetch-result"></div>
    </section>

    <!-- Request Section -->
    <section id="request" class="tool">
      <h3 class="section-title">Request a movie</h3>
      <div class="tool-row">
        <a class="btn" id="tg-btn" href="https://t.me/your_group_link" target="_blank">Join Telegram</a>
        <button class="btn" id="copy-format">Copy request format</button>
      </div>
      <textarea id="request-format" rows="6" style="margin-top:12px;width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0f1622;color:var(--text)">
Movie Title:
Year:
IMDb Link:
Preferred Quality:
Notes:
      </textarea>
    </section>
  </main>

  <div class="toast" id="toast">‚úÖ Request format copied!</div>

  <footer>
    TG Film ‚Äî A modular OTT-style UI with cinematic polish.
  </footer>

  <script>
    /* ========= Data ========= */
    const MOVIES = [
      {
        id:"m1",
        title:"Inception",
        year:"2010",
        genre:["Sci-Fi","Action"],
        rating:"8.8",
        poster:"https://image.tmdb.org/t/p/w500/qmDpIHrmpJINaRKAfWQfftjCdyi.jpg",
        imdb:"https://www.imdb.com/title/tt1375666/",
        tmdb:"https://www.themoviedb.org/movie/27205",
        isNew:true,
        media:{type:"youtube", src:"https://www.youtube.com/embed/YoHD9XEInc0?autoplay=1&mute=1"}
      },
      {
        id:"m2",
        title:"Interstellar",
        year:"2014",
        genre:["Sci-Fi","Adventure"],
        rating:"8.6",
        poster:"https://image.tmdb.org/t/p/w500/rAiYTfKGqDCRIIqo664sY9XZIvQ.jpg",
        imdb:"https://www.imdb.com/title/tt0816692/",
        tmdb:"https://www.themoviedb.org/movie/157336",
        isNew:true,
        media:{type:"vimeo", src:"https://player.vimeo.com/video/76979871?autoplay=1&muted=1"}
      },
      {
        id:"m3",
        title:"The Dark Knight",
        year:"2008",
        genre:["Action","Crime"],
        rating:"9.0",
        poster:"https://image.tmdb.org/t/p/w500/qJ2tW6WMUDux911r6m7haRef0WH.jpg",
        imdb:"https://www.imdb.com/title/tt0468569/",
        tmdb:"https://www.themoviedb.org/movie/155",
        isNew:true,
        media:{type:"mp4", src:"https://www.w3schools.com/html/mov_bbb.mp4"}
      },
      {
        id:"m4",
        title:"Parasite",
        year:"2019",
        genre:["Thriller","Drama"],
        rating:"8.6",
        poster:"https://image.tmdb.org/t/p/w500/7IiTTgloJzvGI1TAYymCfbfl3v.jpg",
        imdb:"https://www.imdb.com/title/tt6751668/",
        tmdb:"https://www.themoviedb.org/movie/496243",
        isNew:false,
        media:{type:"youtube", src:"https://www.youtube.com/embed/5xH0HfJHsaY?autoplay=1&mute=1"}
      },
      {
        id:"m5",
        title:"Whiplash",
        year:"2014",
        genre:["Drama","Music"],
        rating:"8.5",
        poster:"https://image.tmdb.org/t/p/w500/lIv1QinFqz4dlp5U4lQ6jLGQp0G.jpg",
        imdb:"https://www.imdb.com/title/tt2582802/",
        tmdb:"https://www.themoviedb.org/movie/244786",
        isNew:false,
        media:{type:"youtube", src:"https://www.youtube.com/embed/7d_jQycdQGo?autoplay=1&mute=1"}
      },
      {
        id:"m6",
        title:"Mad Max: Fury Road",
        year:"2015",
        genre:["Action","Adventure"],
        rating:"8.1",
        poster:"https://image.tmdb.org/t/p/w500/kqjL17yufvn9OVLyXYpvtyrFfak.jpg",
        imdb:"https://www.imdb.com/title/tt1392190/",
        tmdb:"https://www.themoviedb.org/movie/76341",
        isNew:false,
        media:{type:"youtube", src:"https://www.youtube.com/embed/hEJnG8R1ZqE?autoplay=1&mute=1"}
      }
    ];

    /* ========= Utilities ========= */
    const qs = (s, r=document)=>r.querySelector(s);
    const qsa = (s, r=document)=>Array.from(r.querySelectorAll(s));

    function showToast(text="Action done!") {
      const t = qs("#toast");
      t.textContent = text;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1800);
    }

    function clampText(str) { return String(str || "").trim(); }

    function highlightMatch(text, query) {
      if(!query) return text;
      const re = new RegExp(`(${escapeRegExp(query)})`, "ig");
      return text.replace(re, "<mark>$1</mark>");
    }
    function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");}

    /* ========= Header interactions ========= */
    (function headerInteractions(){
      const header = qs("#header");
      window.addEventListener("scroll", ()=>{
        header.classList.toggle("shrink", window.scrollY > 6);
      });
      // Active nav underline by hash
      function setActive(){
        const hash = location.hash || "#hero";
        qsa(".nav-link").forEach(a=>{
          a.classList.toggle("active", a.getAttribute("href")===hash);
        });
      }
      window.addEventListener("hashchange", setActive);
      setActive();
    })();

    /* ========= Carousel ========= */
    const Carousel = (function(){
      let idx = 0, timer = null;
      const slides = qsa(".hero-slide");
      const dotsWrap = qs("#hero-dots");
      const prev = qs("#prev"), next = qs("#next");

      function renderDots(){
        dotsWrap.innerHTML = "";
        slides.forEach((_, i)=>{
          const d = document.createElement("div");
          d.className = "dot" + (i===idx ? " active" : "");
          d.dataset.index = i;
          d.addEventListener("click", ()=>go(i));
          dotsWrap.appendChild(d);
        });
      }
      function go(i){
        slides.forEach(s=>s.classList.remove("active","enter"));
        idx = (i + slides.length) % slides.length;
        const s = slides[idx];
        s.classList.add("enter");
        requestAnimationFrame(()=>s.classList.add("active"));
        renderDots();
      }
      function nextSlide(){ go(idx+1); }
      function prevSlide(){ go(idx-1); }
      function autoStart(){
        clearInterval(timer);
        timer = setInterval(nextSlide, 5000);
      }
      prev.addEventListener("click", ()=>{prevSlide();autoStart();});
      next.addEventListener("click", ()=>{nextSlide();autoStart();});
      qsa("[data-hero-play]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const movie = MOVIES[btn.dataset.heroPlay|0];
          Playback.open(movie);
        });
      });
      renderDots(); autoStart();
      return { go, next:nextSlide, prev:prevSlide };
    })();

    /* ========= Card rendering ========= */
    function createCard(movie){
      const card = document.createElement("div");
      card.className = "card";
      card.dataset.title = movie.title.toLowerCase();

      const media = document.createElement("div");
      media.className = "card-media";
      media.innerHTML = `<img src="${movie.poster}" alt="${movie.title}" loading="lazy">`;
      card.appendChild(media);

      if(movie.isNew){
        const badge = document.createElement("div");
        badge.className = "badge-new";
        badge.textContent = "NEW";
        card.appendChild(badge);
      }

      const overlay = document.createElement("div");
      overlay.className = "card-overlay";
      overlay.innerHTML = `
        <h4 class="card-title">${movie.title}</h4>
        <div class="card-meta">${movie.year} ‚Ä¢ ${movie.genre.join(", ")} ‚Ä¢ ‚≠ê ${movie.rating}</div>
        <div class="card-actions">
          <button class="btn" data-play="${movie.id}">Play ‚ñ∂</button>
          <a class="btn" href="${movie.imdb}" target="_blank">IMDb</a>
        </div>
      `;
      card.appendChild(overlay);

      card.addEventListener("click", (e)=>{
        const isBtn = e.target.closest("[data-play]");
        if(isBtn || e.target.closest(".card-media")){
          Playback.open(movie);
          window.scrollTo({top:0, behavior:"smooth"});
        }
      });

      return card;
    }

    function renderGrids(){
      const newWrap = qs("#grid-new");
      const recWrap = qs("#grid-recommended");
      newWrap.innerHTML = ""; recWrap.innerHTML = "";
      MOVIES.forEach(m=>{
        const card = createCard(m);
        if(m.isNew) newWrap.appendChild(card);
        else recWrap.appendChild(card);
      });
    }
    renderGrids();

    /* ========= Live Search with highlight ========= */
    (function liveSearch(){
      const input = qs("#search");
      input.addEventListener("input", ()=>{
        const q = clampText(input.value).toLowerCase();
        qsa(".card").forEach(card=>{
          const title = card.dataset.title || "";
          const match = title.includes(q);
          card.style.display = match ? "" : "none";
          const h = card.querySelector(".card-title");
          if(h){
            h.innerHTML = match ? highlightMatch(h.textContent, q) : h.textContent;
          }
        });
      });
    })();

    /* ========= Playback ========= */
    const Playback = (function(){
      const wrap = qs("#movie-player");
      const frame = qs("#player-frame");
      const title = qs("#player-title");
      const tags = qs("#player-tags");
      const close = qs("#player-close");
      const imdbBtn = qs("#open-imdb");
      const tmdbBtn = qs("#open-tmdb");

      let current = null;

      function renderFrame(media){
        frame.innerHTML = "";
        if(media.type === "youtube" || media.type === "vimeo"){
          const iframe = document.createElement("iframe");
          iframe.src = media.src;
          iframe.allow = "autoplay; encrypted-media; picture-in-picture";
          iframe.allowFullscreen = true;
          iframe.style.width = "100%";
          iframe.style.height = "100%";
          iframe.frameBorder = "0";
          frame.appendChild(iframe);
        } else if (media.type === "mp4") {
          const video = document.createElement("video");
          video.src = media.src;
          video.controls = true;
          video.autoplay = true;
          video.muted = true;
          video.style.width = "100%";
          video.style.height = "100%";
          frame.appendChild(video);
        } else {
          frame.innerHTML = `<div style="display:grid;place-items:center;height:100%;color:var(--muted)">Unsupported media</div>`;
        }
      }

      function open(movie){
        current = movie;
        title.textContent = `${movie.title} (${movie.year})`;
        tags.innerHTML = `
          <span>Genres: ${movie.genre.join(", ")}</span>
          <span>‚Ä¢ Rating: ‚≠ê ${movie.rating}</span>
        `;
        renderFrame(movie.media);
        imdbBtn.onclick = ()=> window.open(movie.imdb, "_blank");
        tmdbBtn.onclick = ()=> window.open(movie.tmdb, "_blank");
        wrap.classList.add("active");
      }
      function closePlayer(){
        wrap.classList.remove("active");
        setTimeout(()=>{ frame.innerHTML=""; current=null; }, 350);
      }
      close.addEventListener("click", closePlayer);
      return { open, close: closePlayer };
    })();

    /* ========= IMDb ‚Üí TMDb poster fetch ========= */
    async function fetchPosterByIMDb(imdbId, tmdbKey){
      // Show skeleton
      const result = qs("#fetch-result");
      result.innerHTML = `<div class="skeleton"></div><div class="result-info"><div class="skeleton" style="width:100%;height:20px"></div><div class="skeleton" style="width:70%;height:20px;margin-top:6px"></div></div>`;

      const id = imdbId.trim();
      const key = tmdbKey.trim();
      if(!id || !key){
        await new Promise(r=>setTimeout(r, 400));
        result.innerHTML = `<div style="color:var(--danger)">Please enter both IMDb ID and TMDb API key.</div>`;
        return;
      }

      try{
        // TMDb Find endpoint using external source imdb_id
        const url = `https://api.themoviedb.org/3/find/${encodeURIComponent(id)}?api_key=${encodeURIComponent(key)}&external_source=imdb_id`;
        const res = await fetch(url);
        if(!res.ok) throw new Error("TMDb error: " + res.status);
        const data = await res.json();
        const item = (data.movie_results && data.movie_results[0]) || (data.tv_results && data.tv_results[0]);
        if(!item){
          result.innerHTML = `<div style="color:var(--danger)">No TMDb match found for ${id}.</div>`;
          return;
        }
        const poster = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : "";
        const title = item.title || item.name || "Unknown";
        const tmdbUrl = `https://www.themoviedb.org/${item.media_type || "movie"}/${item.id}`;
        const imdbUrl = `https://www.imdb.com/title/${id}/`;
        result.innerHTML = `
          <img src="${poster}" alt="${title}" loading="lazy">
          <div class="result-info">
            <h4 style="margin:0 0 6px">${title}</h4>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <a class="btn" href="${imdbUrl}" target="_blank">IMDb</a>
              <a class="btn" href="${tmdbUrl}" target="_blank">TMDb</a>
            </div>
          </div>
        `;
      }catch(err){
        result.innerHTML = `<div style="color:var(--danger)">Fetch failed: ${err.message}</div>`;
      }
    }

    qs("#fetch-poster").addEventListener("click", ()=>{
      const imdb = qs("#imdb-id").value;
      const key = qs("#tmdb-key").value;
      fetchPosterByIMDb(imdb, key);
    });

    /* ========= Request copy ========= */
    qs("#copy-format").addEventListener("click", async ()=>{
      const txt = qs("#request-format").value;
      try{
        await navigator.clipboard.writeText(txt);
        showToast("‚úÖ Request format copied!");
      }catch{
        showToast("‚ùå Copy failed. Select and copy manually.");
      }
    });

    /* ========= Accessibility: focus outlines on keyboard ========= */
    (function a11y(){
      function handleFirstTab(e){
        if(e.key === "Tab"){
          document.body.classList.add("user-tabbing");
          window.removeEventListener("keydown", handleFirstTab);
        }
      }
      window.addEventListener("keydown", handleFirstTab);
    })();
  </script>
</body>
</html>
